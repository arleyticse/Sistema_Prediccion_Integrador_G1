<div class="configuracion-empresa-container">
  <p-toast />

  <!-- Encabezado -->
  <div class="mb-4">
    <h2 class="text-2xl font-bold text-gray-800 mb-2">Configuración de la Empresa</h2>
    <p class="text-gray-600">Configure la información y logo de su empresa</p>
  </div>

  <!-- Spinner de carga inicial -->
  <div *ngIf="cargando()" class="flex justify-center items-center py-8">
    <p-progressSpinner />
  </div>

  <!-- Formulario -->
  <div *ngIf="!cargando()">
    <form [formGroup]="configuracionForm" (ngSubmit)="guardarConfiguracion()">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        
        <!-- Logo de la Empresa -->
        <div class="md:col-span-2">
          <p-card header="Logo de la Empresa" styleClass="mb-4">
            <div class="flex flex-col items-center gap-4">
              
              <!-- Vista previa del logo -->
              <div *ngIf="logoUrl()" class="border-2 border-gray-200 rounded-lg p-4">
                <img 
                  [src]="logoUrl()" 
                  alt="Logo de la empresa" 
                  class="max-w-xs max-h-48 object-contain"
                />
              </div>

              <!-- Mensaje si no hay logo -->
              <div *ngIf="!logoUrl()" class="text-center text-gray-500 py-4">
                <i class="pi pi-image text-4xl mb-2"></i>
                <p>No hay logo configurado</p>
              </div>

              <!-- Botones de acción -->
              <div class="flex gap-2">
                <p-fileupload 
                  #fileUpload
                  mode="basic" 
                  name="logo"
                  chooseLabel="Seleccionar Logo"
                  chooseIcon="pi pi-upload"
                  accept="image/png,image/jpeg,image/jpg,image/webp"
                  [maxFileSize]="102400"
                  (onSelect)="onSeleccionarLogo($event)"
                  [auto]="true"
                  [customUpload]="true"
                />

                <p-button 
                  *ngIf="logoUrl()"
                  label="Eliminar Logo" 
                  icon="pi pi-trash" 
                  severity="danger"
                  [outlined]="true"
                  (onClick)="eliminarLogo()"
                  [disabled]="guardando()"
                />
              </div>

              <small class="text-gray-500 text-center">
                Formatos: PNG, JPEG, WebP • Tamaño máximo: 100KB • Dimensiones recomendadas: 300x300px
              </small>
            </div>
          </p-card>
        </div>

        <!-- Información General -->
        <div class="md:col-span-2">
          <p-card header="Información General" styleClass="mb-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              
              <!-- Nombre de la Empresa -->
              <div class="flex flex-col gap-2">
                <label for="nombreEmpresa" class="font-semibold">
                  Nombre de la Empresa <span class="text-red-500">*</span>
                </label>
                <input 
                  id="nombreEmpresa"
                  type="text" 
                  pInputText 
                  formControlName="nombreEmpresa"
                  placeholder="Ej: Mi Empresa SAC"
                  class="w-full"
                />
                <small 
                  *ngIf="configuracionForm.get('nombreEmpresa')?.invalid && configuracionForm.get('nombreEmpresa')?.touched"
                  class="text-red-500"
                >
                  El nombre de la empresa es requerido
                </small>
              </div>

              <!-- RUC -->
              <div class="flex flex-col gap-2">
                <label for="ruc" class="font-semibold">RUC</label>
                <input 
                  id="ruc"
                  type="text" 
                  pInputText 
                  formControlName="ruc"
                  placeholder="Ej: 20123456789"
                  class="w-full"
                />
              </div>

              <!-- Teléfono -->
              <div class="flex flex-col gap-2">
                <label for="telefono" class="font-semibold">Teléfono</label>
                <input 
                  id="telefono"
                  type="text" 
                  pInputText 
                  formControlName="telefono"
                  placeholder="Ej: +51 999 888 777"
                  class="w-full"
                />
              </div>

              <!-- Email -->
              <div class="flex flex-col gap-2">
                <label for="email" class="font-semibold">Email</label>
                <input 
                  id="email"
                  type="email" 
                  pInputText 
                  formControlName="email"
                  placeholder="Ej: contacto@miempresa.com"
                  class="w-full"
                />
                <small 
                  *ngIf="configuracionForm.get('email')?.invalid && configuracionForm.get('email')?.touched"
                  class="text-red-500"
                >
                  Ingrese un email válido
                </small>
              </div>

              <!-- Dirección (ocupa 2 columnas) -->
              <div class="flex flex-col gap-2 md:col-span-2">
                <label for="direccion" class="font-semibold">Dirección</label>
                <textarea 
                  id="direccion"
                  pInputTextarea 
                  formControlName="direccion"
                  placeholder="Ej: Av. Principal 123, Lima, Perú"
                  rows="3"
                  class="w-full"
                ></textarea>
              </div>
            </div>
          </p-card>
        </div>

        <!-- Información de Contacto -->
        <div class="md:col-span-2">
          <p-card header="Persona de Contacto" styleClass="mb-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              
              <!-- Nombre de Contacto -->
              <div class="flex flex-col gap-2">
                <label for="nombreContacto" class="font-semibold">Nombre</label>
                <input 
                  id="nombreContacto"
                  type="text" 
                  pInputText 
                  formControlName="nombreContacto"
                  placeholder="Ej: Juan Pérez"
                  class="w-full"
                />
              </div>

              <!-- Cargo de Contacto -->
              <div class="flex flex-col gap-2">
                <label for="cargoContacto" class="font-semibold">Cargo</label>
                <input 
                  id="cargoContacto"
                  type="text" 
                  pInputText 
                  formControlName="cargoContacto"
                  placeholder="Ej: Gerente General"
                  class="w-full"
                />
              </div>
            </div>
          </p-card>
        </div>

        <!-- Botones de acción -->
        <div class="md:col-span-2 flex justify-end gap-2 mt-4">
          <p-button 
            label="Cancelar" 
            icon="pi pi-times" 
            severity="secondary"
            [outlined]="true"
            (onClick)="cargarConfiguracion()"
            [disabled]="guardando()"
          />

          <p-button 
            type="submit"
            label="Guardar Configuración" 
            icon="pi pi-save" 
            [loading]="guardando()"
            [disabled]="configuracionForm.invalid || guardando()"
          />
        </div>
      </div>
    </form>
  </div>
</div>
