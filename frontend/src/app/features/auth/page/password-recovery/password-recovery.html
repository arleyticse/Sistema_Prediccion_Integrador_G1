<div class="min-h-screen flex items-center justify-center bg-slate-100 dark:bg-[#0f172a] p-4 relative overflow-hidden">
  <!-- Background decor -->
  <div class="absolute top-[-10%] left-[-10%] w-[420px] h-[420px] rounded-full bg-[#0077c2]/30 dark:bg-[#59a5f5]/20 blur-[80px] animate-pulse"></div>
  <div class="absolute bottom-[-10%] right-[-10%] w-[420px] h-[420px] rounded-full bg-[#00bfff]/30 dark:bg-[#00619a]/20 blur-[80px] animate-pulse" style="animation-delay: 2s"></div>

  <p-toast position="top-center"></p-toast>

  <div class="w-full max-w-md relative z-10">
    <div class="backdrop-blur-md bg-[#ffffff]/70 dark:bg-[#333333]/40 border border-[#ffffff]/50 dark:border-[#5c5c5c]/10 rounded-2xl shadow-xl p-8">
      <!-- Header -->
      <div class="text-center mb-6">
        <div class="inline-flex items-center justify-center w-14 h-14 mb-4 rounded-full bg-[#0077c2]/10 dark:bg-[#59a5f5]/20">
          <i class="pi pi-lock text-2xl text-[#0077c2] dark:text-[#59a5f5]"></i>
        </div>
        <h2 class="text-2xl font-bold text-[#333333] dark:text-[#ffffff] mb-1">{{ currentStep() === 'success' ? '¡Contraseña Restablecida!' : 'Recuperar Contraseña' }}</h2>
        <p class="text-sm text-[#5c5c5c] dark:text-[#cccccc]">{{ getStepSubtitle() }}</p>
      </div>

      <!-- Mensajes de error/éxito -->
      <div *ngIf="errorMessage() || successMessage()" class="mb-4">
        <p-message *ngIf="errorMessage()" severity="error" text="{{ errorMessage() }}" styleClass="w-full" />
        <p-message *ngIf="successMessage() && currentStep() !== 'success'" severity="success" text="{{ successMessage() }}" styleClass="w-full mt-2" />
      </div>

      <!-- Paso 1: Ingresar Email -->
      <div *ngIf="currentStep() === 'email'" class="space-y-4">
        <div class="space-y-2">
          <label class="block text-sm font-medium text-[#333333] dark:text-[#cccccc]">Correo Electrónico</label>
          <div class="relative">
            <i class="pi pi-envelope absolute left-3 top-1/2 -translate-y-1/2 text-[#5c5c5c] dark:text-[#cccccc]"></i>
            <input pInputText
              id="email"
              [(ngModel)]="email"
              type="email"
              [disabled]="loading()"
              (keyup.enter)="requestPasswordReset()"
              class="w-full !pl-10 !py-3 !bg-[#ffffff]/50 dark:!bg-[#333333]/50 border-[#cccccc] dark:border-[#5c5c5c] focus:border-[#0077c2] text-[#333333] dark:text-[#ffffff] rounded-lg transition-all"/>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <p-button
            label="Enviar Código"
            icon="pi pi-send"
            [loading]="loading()"
            [disabled]="!canSubmitEmail()"
            (onClick)="requestPasswordReset()"
            styleClass="col-span-2 !bg-[#0077c2] hover:!bg-[#59a5f5] !text-[#ffffff] !font-semibold !py-3.5 !rounded-lg shadow-md dark:!bg-[#59a5f5] dark:hover:!bg-[#c8ffff]"
          />
          <p-button
            label="Volver al Login"
            icon="pi pi-arrow-left"
            [text]="true"
            (onClick)="goToLogin()"
            styleClass="col-span-2 !mt-0"
          />
        </div>
      </div>

      <!-- Paso 2: Ingresar código OTP -->
      <div *ngIf="currentStep() === 'otp'" class="space-y-4">
        <div class="space-y-2 text-sm text-[#333333] dark:text-[#cccccc]">
          <p class="flex items-center gap-2">
            <i class="pi pi-envelope text-[#0077c2]"></i>
            Hemos enviado un código de 6 dígitos a:
          </p>
          <strong class="block">{{ email() }}</strong>
          <small *ngIf="expiryTime()">El código expira en {{ expiryTime() }}</small>
        </div>
        <div>
          <label class="block text-sm font-medium text-[#333333] dark:text-[#cccccc] mb-2">Código de verificación</label>
          <p-inputotp
            [(ngModel)]="otpCode"
            [length]="6"
            [integerOnly]="true"
            styleClass="w-full text-center bg-[#ffffff]/50 dark:!bg-[#333333]/50 p-2 rounded-lg"
          />
        </div>
        <div class="grid grid-cols-2 gap-3">
          <p-button
            label="Verificar Código"
            icon="pi pi-check"
            [loading]="loading()"
            [disabled]="!canVerifyOtp()"
            (onClick)="verifyOtpCode()"
            styleClass="col-span-2 !bg-[#0077c2] hover:!bg-[#59a5f5] !text-[#ffffff] !font-semibold !py-3.5 !rounded-lg shadow-md"
          />
          <p-button
            label="Reenviar Código"
            icon="pi pi-refresh"
            [text]="true"
            (onClick)="resendCode()"
            styleClass="col-span-1 !mt-0"
          />
          <p-button
            label="Cambiar Email"
            icon="pi pi-arrow-left"
            [text]="true"
            (onClick)="restart()"
            styleClass="col-span-1 !mt-0"
          />
        </div>
      </div>

      <!-- Paso 3: Nueva contraseña -->
      <div *ngIf="currentStep() === 'password'" class="space-y-4">
        <div class="space-y-2">
          <label class="block text-sm font-medium text-[#333333] dark:text-[#cccccc]">Nueva Contraseña</label>
          <p-password
            inputStyleClass="w-full !py-3 !bg-[#ffffff]/50 dark:!bg-[#333333]/50 border-[#cccccc] dark:border-[#5c5c5c] focus:border-[#0077c2] text-[#333333] dark:text-[#ffffff] rounded-lg transition-all"
            [(ngModel)]="newPassword"
            feedback="false" [toggleMask]="true">
          </p-password>
        </div>
        <div class="space-y-2">
          <label class="block text-sm font-medium text-[#333333] dark:text-[#cccccc]">Confirmar Contraseña</label>
          <p-password
            inputStyleClass="w-full !py-3 !bg-[#ffffff]/50 dark:!bg-[#333333]/50 border-[#cccccc] dark:border-[#5c5c5c] focus:border-[#0077c2] text-[#333333] dark:text-[#ffffff] rounded-lg transition-all"
            [(ngModel)]="confirmPassword" feedback="false" [toggleMask]="true" (keyup.enter)="resetPassword()">
          </p-password>
        </div>
        <div>
          <p-message *ngIf="newPassword() && !isPasswordValid()" severity="warn" text="La contraseña debe tener al menos 6 caracteres" styleClass="w-full" />
          <p-message *ngIf="confirmPassword() && !passwordsMatch()" severity="warn" text="Las contraseñas no coinciden" styleClass="w-full" />
        </div>
        <div class="grid grid-cols-1 gap-3">
          <p-button
            label="Restablecer Contraseña"
            icon="pi pi-check-circle"
            [loading]="loading()"
            [disabled]="!canResetPassword()"
            (onClick)="resetPassword()"
            styleClass="!bg-[#0077c2] hover:!bg-[#59a5f5] !text-[#ffffff] !font-semibold !py-3.5 !rounded-lg shadow-md w-full"
          />
        </div>
      </div>

      <!-- Paso 4: Éxito -->
      <div *ngIf="currentStep() === 'success'" class="text-center space-y-4">
        <div class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-[#c8ffff] dark:bg-[#00619a]/30 mx-auto">
          <i class="pi pi-check-circle text-5xl text-[#0077c2]"></i>
        </div>
        <p-message severity="success" [text]="successMessage()!" styleClass="w-full mb-4" />
        <p class="text-sm text-[#333333] dark:text-[#cccccc]">Serás redirigido al login en 3 segundos...</p>
        <p-button
          label="Ir al Login Ahora"
          icon="pi pi-sign-in"
          (onClick)="goToLogin()"
          styleClass="!bg-[#0077c2] hover:!bg-[#59a5f5] !text-[#ffffff] !font-semibold !py-3.5 !rounded-lg w-full"
        />
      </div>

      <!-- Loading spinner -->
      <div *ngIf="loading()" class="fixed inset-0 flex items-center justify-center bg-[#333333]/20 z-50">
        <p-progressspinner strokeWidth="4" styleClass="!align-center" />
      </div>

    </div>
  </div>
</div>
